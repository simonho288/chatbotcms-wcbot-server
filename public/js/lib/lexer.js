function Lexer(t){"function"!=typeof t&&(t=Lexer.defunct);var e=[],i=[],r=0;this.state=0,this.index=0,this.input="",this.addRule=function(t,e,r){var n=t.global;if(!n){var s="g";t.multiline&&(s+="m"),t.ignoreCase&&(s+="i"),t=new RegExp(t.source,s)}return"[object Array]"!==Object.prototype.toString.call(r)&&(r=[0]),i.push({pattern:t,global:n,action:e,start:r}),this},this.setInput=function(t){return r=0,this.state=0,this.index=0,e.length=0,this.input=t,this},this.lex=function(){if(e.length)return e.shift();for(this.reject=!0;this.index<=this.input.length;){for(var n=function(){for(var t=[],e=0,r=this.state,n=this.index,s=this.input,h=0,a=i.length;h<a;h++){var l=i[h],o=l.start,c=o.length;if(!c||o.indexOf(r)>=0||r%2&&1===c&&!o[0]){var u=l.pattern;u.lastIndex=n;var f=u.exec(s);if(f&&f.index===n){var d=t.push({result:f,action:l.action,length:f[0].length});for(l.global&&(e=d);--d>e;){var p=d-1;if(t[d].length>t[p].length){var x=t[d];t[d]=t[p],t[p]=x}}}}}return t}.call(this).splice(r),s=this.index;n.length&&this.reject;){var h=n.shift(),a=h.result,l=h.length;this.index+=l,this.reject=!1,r++;c=h.action.apply(this,a);if(this.reject)this.index=a.index;else if(void 0!==c)switch(Object.prototype.toString.call(c)){case"[object Array]":e=c.slice(1),c=c[0];default:return l&&(r=0),c}}var o=this.input;if(s<o.length)if(this.reject){r=0;var c;if(void 0!==(c=t.call(this,o.charAt(this.index++))))return"[object Array]"===Object.prototype.toString.call(c)?(e=c.slice(1),c[0]):c}else this.index!==s&&(r=0),this.reject=!0;else{if(!n.length)break;this.reject=!0}}}}"object"==typeof module&&"object"==typeof module.exports&&(module.exports=Lexer),Lexer.defunct=function(t){throw new Error("Unexpected character at index "+(this.index-1)+": "+t)};