"use strict";function LoadShoppingCart(){return $.ajax({method:"GET",url:"/db_loadcart",data:{uid:window._userId,rid:window._recipientId}})}function DoCheckout(){var t="/mwp?page=orderInfoInput&uid="+window._userId+"&rid="+window._recipientId;null!=window._orderId&&""!=window._orderId&&(t+="&oid="+window._orderId),window.location.href=t}function SaveCart(t){var e=util.CloneObject(window._shoppingCart);delete e.server_settings,$.ajax({type:"POST",url:"/db_savecart",data:JSON.stringify({userId:window._userId,recipientId:window._recipientId,cart:e}),contentType:"application/json"}).done(function(e){"ok"===e&&t&&t(!0)}).fail(function(e,i,n){t&&t(!1)})}function findItemInCart(t){for(var e=0;e<window._shoppingCart.cart_items.length;++e){var i=window._shoppingCart.cart_items[e];if(i._itemId==t)return i}return null}function CalculateTotal(){var t=0;$(".card").each(function(e,i){var n=findItemInCart($(this).data("itemid"));t+=n._qty*n._unitPrice});var e=util.ParseCurrencyToDisp(window._shoppingCart.server_settings.currency,t);$("#amount").html(e)}function RemoveItemFromCart(t){var e=[];$.each(window._shoppingCart.cart_items,function(i,n){n._itemId!=t&&e.push(n)}),window._shoppingCart.cart_items=e,RenderCartAndSetupEvent()}function EnableAllButtons(t){t?$("#btn_checkout").removeClass("disabled loading"):$("#btn_checkout").addClass("disabled loading")}function RenderCartToElem(){var t=window._shoppingCart.cart_items,e=$("#cartItem").html(),i="";0===t.length?i="No items in shopping cart. Please close this window and add item to cart in Messenger":$.each(t,function(t,n){for(var r="",a=1;a<100;a++)a!=n._qty?r+='<option value="'+a+'">'+a+"</option>":r+='<option value="'+a+'" selected="selected">'+a+"</option>";var o=n._qty*n._unitPrice,d=util.ParseCurrencyToDisp(window._shoppingCart.server_settings.currency,o,!1),c=e.replace(/item_image/g,n._image).replace(/item_itemName/g,n._itemName).replace(/item_itemId/g,n._itemId).replace(/item_unitPrice/g,numeral(n._unitPrice).format("0,0[.]00")).replace(/item_subTotal/g,d).replace(/item_qtyDropDown/g,r);i+=c}),$("#cartitems_div").html(i),0===t.length&&$("#btn_checkout").attr("disabled","disabled"),CalculateTotal()}function RenderCartAndSetupEvent(){RenderCartToElem();window._shoppingCart.cart_items;$(".item_qty").off().on("change",function(t){var e=t.target.value,i=findItemInCart(t.target.id);i._qty=e;var n=e*i._unitPrice,r="Sub-total: "+util.ParseCurrencyToDisp(window._shoppingCart.server_settings.currency,n,!1);$(t.target).closest(".card").find(".sub_total").html(r),SaveCart(),CalculateTotal()}),$(".btn_remove").off().on("click",function(t){RemoveItemFromCart($(this).data("itemid")),SaveCart()})}$(document).ready(function(){LoadShoppingCart().done(function(t){$(".loading_wrapper").hide(),$(".loaded_wrapper").show(),window._shoppingCart=t,RenderCartAndSetupEvent()}).fail(function(t){alert(t.statusText)}),$(".main.menu").visibility({type:"fixed"}),$(".overlay").visibility({type:"fixed",offset:80}),$(".image").visibility({type:"image",transition:"vertical flip in",duration:500}),$(".main.menu .ui.dropdown").dropdown({on:"hover"}),$("#btn_checkout").on("click",function(t){EnableAllButtons(!1),SaveCart(function(t){t&&DoCheckout()})})});