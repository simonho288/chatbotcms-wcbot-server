"use strict";function SetupUI(){$("#btn_proceed").click(onBtnProceed),$("#btn_back").click(onBtnBack)}function RenderItemsIntoTable(){for(var t="",e=0,r=0,i=window._shoppingCart.server_settings.currency,a=0,o=window._wcOrder.line_items.length;a<o;++a){var n=window._wcOrder.line_items[a];n.subtotal=parseFloat(n.subtotal),n.subtotal_tax=parseFloat(n.subtotal_tax),n.total=parseFloat(n.total),n.total_tax=parseFloat(n.total_tax);for(var d=null,l=0,s=window._shoppingCart.cart_items.length;l<s;++l){var c=window._shoppingCart.cart_items[l];if(c._itemId==n.product_id){d=c;break}}d._qty=parseFloat(d._qty),d._unitPrice=parseFloat(d._unitPrice),d._unitTax=n.subtotal_tax/n.quantity,d._subTotal=n.subtotal+n.subtotal_tax,e+=n.subtotal,r+=n.subtotal_tax,t+="<tr>",t+="<td>",t+='<img src="'+d._image+'" />',t+="</td>",t+="<td>",t+=d._itemName,t+="</td>",t+='<td style="text-align: right">',t+=d._qty,t+="</td>",t+='<td style="text-align: right">',t+=util.ParseCurrencyToDisp(i,d._unitPrice,!1),t+="</td>",t+='<td style="text-align: right">',t+=util.ParseCurrencyToDisp(i,d._unitTax,!1),t+="</td>",t+='<td style="text-align: right">',t+=util.ParseCurrencyToDisp(i,d._subTotal),t+="</td>",t+="</tr>"}var u=parseFloat(window._wcOrder.shipping_total),_=parseFloat(window._wcOrder.shipping_tax),w=e+r+u+_;$("#order_total").html(util.ParseCurrencyToDisp(i,e)),$("#order_tax").html(util.ParseCurrencyToDisp(i,r)),$("#ship_total").html(util.ParseCurrencyToDisp(i,u)),$("#ship_tax").html(util.ParseCurrencyToDisp(i,_)),$("#total_amount").html(util.ParseCurrencyToDisp(i,w)),$("#table_items tbody").html(t)}function LoadShoppingCart(){return $.ajax({method:"GET",url:"/db_loadcart",data:{uid:window._userId,rid:window._recipientId}})}function LoadWcOrder(){return $.ajax({method:"GET",url:"/get_wc_order",data:{uid:window._userId,rid:window._recipientId,oid:window._orderId}})}function RemoveWcOrder(){return $.ajax({type:"DELETE",url:"/remove_wc_order",data:{oid:window._orderId,uid:window._userId,rid:window._recipientId}})}function EnableAllButtons(t){t?($("#btn_proceed").removeClass("disabled loading"),$("#btn_back").removeClass("disabled loading")):($("#btn_proceed").addClass("disabled loading"),$("#btn_back").addClass("disabled loading"))}function onBtnBack(t){var e=$("#dlg_discardwarn");e.modal("show"),e.find("#btn_ok").click(function(t){EnableAllButtons(!1),RemoveWcOrder().done(function(){var t="/mwp?page=shopCart&uid="+window._userId+"&rid="+window._recipientId;window.location.href=t}).fail(function(t){})}),e.find("#btn_cancel").click(function(t){$("#dlg_discardwarn").modal("hide")})}function onBtnProceed(t){EnableAllButtons(!1),window.location.href="/mwp?page=orderPayment&oid="+window._orderId+"&uid="+window._userId+"&rid="+window._recipientId}$(document).ready(function(){$.when(LoadShoppingCart(),LoadWcOrder()).done(function(t,e){window._shoppingCart=t[0],window._wcOrder=e[0],RenderItemsIntoTable(),$(".loading_wrapper").hide(),$(".loaded_wrapper").show(),SetupUI()}).fail(function(t){})});