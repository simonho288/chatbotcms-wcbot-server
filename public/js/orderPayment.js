"use strict";function SetupUI(){$(".ui.accordion").accordion(),$(".btn_pay").click(function(t){window._curPaymentMethod=$(this).data("paymentmethod"),window._curPaymentMethodTitle=$(this).data("paymentmethodtitle")}),$("#btn_back").click(onBtnBack),$("#btn_paypal_pay").click(OnPayWithPaypal),$("#btn_bacs_pay").click(OnPayWithBacs),$("#btn_cheque_pay").click(OnPayWithCheque),$("#btn_cod_pay").click(OnPayWithCod)}function PayPalFormSubmit(t,e,i){var a=_shoppingCart.server_settings.currency.value,n=genPayPalMarkup([{name:"Chatbot CMS - WooCommerce Order no. "+window._orderId,qty:1,price:window._totalAmount,itemId:"chatbotcms_woocommerce"}],!0,a,i,t,{notify:document.location.origin+"/paypal-notify",cancel:document.location.origin+"/mwp?page=paymentFailure&pid="+i,success:document.location.origin+"/mwp?page=orderReceived&pid="+i});$("#hot_form_div").empty();var d=$(n);$("#hot_form_div").append(d),d.submit()}function OnPayWithPaypal(t){window._curPaymentMethod=$(this).data("paymentmethod"),window._curPaymentMethodTitle=$(this).data("paymentmethodtitle");var e=$(this).data("email"),i="yes"===$(this).data("sandbox");$(this).addClass("disabled loading"),$("#btn_back").addClass("disabled loading"),$.ajax({url:"/checkout_submit",type:"POST",data:JSON.stringify({gateway:"paypal",userId:window._userId,recipientId:window._recipientId,orderId:window._orderId,totalAmount:_totalAmount,payment_method:window._curPaymentMethod,payment_method_title:window._curPaymentMethodTitle}),contentType:"application/json"}).done(function(t){PayPalFormSubmit(e,i,t.paymentId)}).fail(function(t){})}function OnPayWithBacs(t){window._curPaymentMethod=$(this).data("paymentmethod"),window._curPaymentMethodTitle=$(this).data("paymentmethodtitle"),$(this).addClass("disabled loading"),$("#btn_back").addClass("disabled loading"),$.ajax({url:"/checkout_submit",type:"POST",data:JSON.stringify({userId:window._userId,recipientId:window._recipientId,orderId:window._orderId,totalAmount:window._totalAmount,payment_method:window._curPaymentMethod,payment_method_title:window._curPaymentMethodTitle}),contentType:"application/json"}).done(function(t){window.location.href="/mwp?page=orderReceived&pid="+t.paymentId}).fail(function(t){$("#btn_bacs_pay").removeClass("disabled loading"),$("#btn_back").removeClass("disabled loading")})}function OnPayWithCheque(){window._curPaymentMethod=$(this).data("paymentmethod"),window._curPaymentMethodTitle=$(this).data("paymentmethodtitle"),$(this).addClass("disabled loading"),$("#btn_back").addClass("disabled loading"),$.ajax({url:"/checkout_submit",type:"POST",data:JSON.stringify({userId:window._userId,recipientId:window._recipientId,orderId:window._orderId,totalAmount:window._totalAmount,payment_method:window._curPaymentMethod,payment_method_title:window._curPaymentMethodTitle}),contentType:"application/json"}).done(function(t){window.location.href="/mwp?page=orderReceived&pid="+t.paymentId}).fail(function(t){$("#btn_bacs_pay").removeClass("disabled loading"),$("#btn_back").removeClass("disabled loading")})}function OnPayWithCod(){window._curPaymentMethod=$(this).data("paymentmethod"),window._curPaymentMethodTitle=$(this).data("paymentmethodtitle"),$(this).addClass("disabled loading"),$("#btn_back").addClass("disabled loading"),$.ajax({url:"/checkout_submit",type:"POST",data:JSON.stringify({userId:window._userId,recipientId:window._recipientId,orderId:window._orderId,totalAmount:window._totalAmount,payment_method:window._curPaymentMethod,payment_method_title:window._curPaymentMethodTitle}),contentType:"application/json"}).done(function(t){window.location.href="/mwp?page=orderReceived&pid="+t.paymentId}).fail(function(t){$("#btn_bacs_pay").removeClass("disabled loading"),$("#btn_back").removeClass("disabled loading")})}function RenderScreen(){for(var t="",e=0;e<window._wcPaymentGateways.length;++e){var i=window._wcPaymentGateways[e];if(i.enabled)switch(i.id){case"bacs":t+='<div class="title">',t+='<div class="dropdown icon"></div>',t+=i.title,t+="</div>",t+='<div class="content">',t+='<p class="transition hidden">',t+=i.description,t+="</p>",t+='<p class="transition hidden">',t+='<button class="ui primary button btn_pay" id="btn_bacs_pay" data-paymentmethod="'+i.id+'" data-paymentmethodtitle="'+i.title+'">',t+="Place Order",t+="</button>",t+="</p>",t+="</div>";break;case"cheque":t+='<div class="title">',t+='<div class="dropdown icon"></div>',t+=i.title,t+="</div>",t+='<div class="content">',t+='<p class="transition hidden">',t+=i.description,t+="</p>",t+='<p class="transition hidden">',t+='<button class="ui primary button btn_pay" id="btn_cheque_pay" data-paymentmethod="'+i.id+'" data-paymentmethodtitle="'+i.title+'">',t+="Place Order",t+="</button>",t+="</p>",t+="</div>";break;case"cod":t+='<div class="title">',t+='<div class="dropdown icon"></div>',t+=i.title,t+="</div>",t+='<div class="content">',t+='<p class="transition hidden">',t+=i.description,t+="</p>",t+='<p class="transition hidden">',t+='<button class="ui primary button btn_pay" id="btn_cod_pay" data-paymentmethod="'+i.id+'" data-paymentmethodtitle="'+i.title+'">',t+="Place Order",t+="</button>",t+="</p>",t+="</div>";break;case"paypal":t+='<div class="title">',t+='<div class="dropdown icon"></div>',t+=i.title,t+="</div>",t+='<div class="content">',t+='<p class="transition hidden">',t+=i.description,t+="</p>",t+='<p class="transition hidden">',t+='<button class="ui primary button btn_pay" id="btn_paypal_pay" data-paymentmethod="'+i.id+'" data-paymentmethodtitle="'+i.title+'" data-email="'+i.settings.email.value+'" data-sandbox="'+i.settings.testmode.value+'">',t+='<i class="paypal icon"></i>',t+="Paid By PayPal",t+="</button>",t+="</p>",t+="</div>";break;case"braintree_credit_card":t+='<div class="title">',t+='<div class="dropdown icon"></div>',t+=i.title,t+="</div>",t+='<div class="content">',t+='<p class="transition hidden">',t+=i.description,t+='<div class="field">',t+='<div class="bt-drop-in-wrapper">',t+='<div id="bt-dropin">',t+="</div>",t+="</div>",t+="</div>",t+='<input id="nonce" type="hidden" name="payment_method_nonce" />',t+='<button class="ui primary button btn_pay" id="btn_braintree_pay" data-paymentmethod="'+i.id+'" data-paymentmethodtitle="'+i.title+'">',t+='<i class="credit card alternative icon"></i>',t+="Paid by Braintree",t+="</button>",t+="</p>",t+="</div>";break;case"stripe":t+='<div class="title">',t+='<div class="dropdown icon"></div>',t+=i.title,t+="</div>",t+='<div class="content">',t+='<p class="transition hidden">',t+=i.description,t+="</p>",t+='<p class="transition hidden">',t+='<div class="field">',t+='<button class="ui primary button btn_pay" id="btn_stripe_pay" data-paymentmethod="'+i.id+'" data-paymentmethodtitle="'+i.title+'">',t+='<i class="stripe icon"></i>',t+="Paid By Stripe",t+="</button>",t+="</div>",t+="</p>",t+="</div>"}}$("#payment_methods").html(t);for(var t="",a=0,n=0,e=0,d=window._wcOrder.line_items.length;e<d;++e){var o=window._wcOrder.line_items[e];o.subtotal=parseFloat(o.subtotal),o.subtotal_tax=parseFloat(o.subtotal_tax),o.total=parseFloat(o.total),o.total_tax=parseFloat(o.total_tax);for(var r=null,s=0,l=window._shoppingCart.cart_items.length;s<l;++s){var c=window._shoppingCart.cart_items[s];if(c._itemId==o.product_id){r=c;break}}r._qty=parseFloat(r._qty),r._unitPrice=parseFloat(r._unitPrice),r._unitTax=o.subtotal_tax/o.quantity,r._subTotal=o.subtotal+o.subtotal_tax,a+=o.subtotal,n+=o.subtotal_tax}var p=a+n+parseFloat(window._wcOrder.shipping_total)+parseFloat(window._wcOrder.shipping_tax);window._totalAmount=parseFloat(p.toFixed(5));var u=util.ParseCurrencyToDisp(window._shoppingCart.server_settings.currency,p);$("#total_amount").html(u)}function LoadShoppingCart(){return $.ajax({method:"GET",url:"/db_loadcart",data:{uid:window._userId,rid:window._recipientId}})}function LoadWcOrder(){return $.ajax({method:"GET",url:"/get_wc_order",data:{uid:window._userId,rid:window._recipientId,oid:window._orderId}})}function LoadWcPaymentGateways(){return $.ajax({method:"GET",url:"/get_wc_paygates",data:{uid:window._userId,rid:window._recipientId}})}function RemoveWcOrder(){return $.ajax({type:"DELETE",url:"/remove_wc_order",data:{oid:window._orderId,uid:window._userId,rid:window._recipientId}})}function EnableAllButtons(t){t?$("#btn_back").removeClass("disabled loading"):$("#btn_back").addClass("disabled loading")}function onBtnBack(t){var e=$("#dlg_discardwarn");e.modal("show"),e.find("#btn_ok").click(function(t){EnableAllButtons(!1),RemoveWcOrder().done(function(){var t="/mwp?page=shopCart&uid="+window._userId+"&rid="+window._recipientId;window.location.href=t}).fail(function(t){})}),e.find("#btn_cancel").click(function(t){$("#dlg_discardwarn").modal("hide")})}function SetupBraintreeCheckout(){function t(t){this.config=t,this.config.development=t.development||!1,this.paymentForm=$("#"+t.formID),this.inputs=$("input[type=text], input[type=email], input[type=tel]"),this.button=this.paymentForm.find(".button"),this.states={show:"active",wait:"loading"},this.focusClass="has-focus",this.valueClass="has-value",this.initialize()}document.querySelector("#braintree-payment-form");var e=window._braintreeClientToken;braintree.dropin.create({authorization:e,container:"#bt-dropin",paypal:{flow:"vault"}},function(t,e){t||$("#btn_braintree_pay").click(function(t){t.preventDefault(),e.requestPaymentMethod(function(t,e){t||($("#btn_braintree_pay").addClass("disabled loading"),$("#btn_back").addClass("disabled loading"),$.ajax({url:"/checkout_submit",type:"POST",data:JSON.stringify({userId:window._userId,recipientId:window._recipientId,orderId:window._orderId,totalAmount:window._totalAmount,braintree_nonce:e.nonce,payment_method:window._curPaymentMethod,payment_method_title:window._curPaymentMethodTitle}),contentType:"application/json"}).done(function(t){window.location.href="/mwp?page=orderReceived&pid="+t.paymentId}).fail(function(t){$("#stripe_error_form").show(),$("#stripe_errmsg").html(t),$("#btn_stripe_pay").removeClass("disabled loading"),$("#btn_back").removeClass("disabled loading")}))})})}),t.prototype.initialize=function(){var t=this;this.events(),this.inputs.each(function(e,i){t.labelHander($(i))}),this.notify("error")},t.prototype.events=function(){var t=this;this.inputs.on("focus",function(){$(this).closest("label").addClass(t.focusClass),t.labelHander($(this))}).on("keydown",function(){t.labelHander($(this))}).on("blur",function(){$(this).closest("label").removeClass(t.focusClass),t.labelHander($(this))})},t.prototype.labelHander=function(t){var e=this,i=t,a=i.closest("label");window.setTimeout(function(){i.val().length>0?a.addClass(e.valueClass):a.removeClass(e.valueClass)},10)},t.prototype.notify=function(t){var e=this,i=$(".notice-"+t),a=!0===this.config.development?4e3:2e3;i.show(),window.setTimeout(function(){i.addClass("show"),e.button.removeClass(e.states.wait),window.setTimeout(function(){i.removeClass("show"),window.setTimeout(function(){i.hide()},310)},a)},10)};new t({formID:"braintree-payment-form"})}function SetupStripeCheckout(){$("#stripe_error_form").hide();var t=StripeCheckout.configure({key:window._stripePublishKey,image:"https://www.alslab.com/logo150x150.png",locale:"en-US",token:function(t){$("#btn_stripe_pay").addClass("disabled loading"),$("#btn_back").addClass("disabled loading"),$.ajax({url:"/checkout_submit",type:"POST",data:JSON.stringify({userId:window._userId,recipientId:window._recipientId,orderId:window._orderId,stripe_token:t.id,totalAmount:window._totalAmount,payment_method:window._curPaymentMethod,payment_method_title:window._curPaymentMethodTitle}),contentType:"application/json"}).done(function(t){window.location.href="/mwp?page=orderReceived&pid="+t.paymentId}).fail(function(t){$("#stripe_error_form").show(),$("#stripe_errmsg").html(t),$("#btn_stripe_pay").removeClass("disabled loading"),$("#btn_back").removeClass("disabled loading")})}});$("#btn_stripe_pay").click(function(e){if(e.preventDefault(),!$("#shipping_form").form("is valid"))return!1;t.open({name:"Chatbot CMS",email:window._shoppingCart.input_info.billing.email,description:"Chatbot CMS - WooCommerce Order",amount:100*_totalAmount})}),window.addEventListener("popstate",function(){t.close()})}function genPayPalMarkup(t,e,i,a,n,d){var o=n;e&&(o="go-facilitator@simonho.net");document.baseURI.substring(0,document.baseURI.lastIndexOf("/"));var r="";r+='<form method="post" action="'+(e?"https://www.sandbox.paypal.com/cgi-bin/webscr":"https://www.paypal.com/cgi-bin/webscr")+'">',r+='<input type="hidden" name="charset" value="utf-8">',r+='<input type="hidden" name="cmd" value="_cart">',r+='<input type="hidden" name="upload" value="1">',r+='<input type="hidden" name="business" value="'+o+'">',r+='<input type="hidden" name="currency_code" value="'+i+'">',r+='<input type="hidden" name="custom" value="'+a+'">',r+='<input type="hidden" name="notify_url" value="'+d.notify+'">',r+='<input type="hidden" name="cancel_return" value="'+d.cancel+'">',r+='<input type="hidden" name="return" value="'+d.success+'">';for(var s=1,l=0;l<t.length;++l){var c=t[l];r+='<input type="hidden" name="item_name_'+(s=l+1)+'" value="'+c.name+'">',r+='<input type="hidden" name="quantity_'+s+'" value ="'+c.qty+'">',r+='<input type="hidden" name="amount_'+s+'" value="'+c.price+'">',r+='<input type="hidden" name="item_number_'+s+'" value="'+c.itemId+'">'}return r+="</form>"}$(document).ready(function(){$.when(LoadShoppingCart(),LoadWcOrder(),LoadWcPaymentGateways()).done(function(t,e,i){window._shoppingCart=t[0],window._wcOrder=e[0],window._wcPaymentGateways=i[0],RenderScreen(),$(".loading_wrapper").hide(),$(".loaded_wrapper").show(),SetupUI(),SetupBraintreeCheckout(),SetupStripeCheckout()}).fail(function(t){})});